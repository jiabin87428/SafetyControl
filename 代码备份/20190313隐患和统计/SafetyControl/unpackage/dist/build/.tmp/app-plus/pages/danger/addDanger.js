(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/danger/addDanger"],{"3eb0":function(t,e,i){"use strict";i.r(e);var n=i("9e07"),s=i("93b6");for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);i("78fb");var o=i("2877"),c=Object(o["a"])(s["default"],n["a"],n["b"],!1,null,null,null);e["default"]=c.exports},"78fb":function(t,e,i){"use strict";var n=i("dc0c"),s=i.n(n);s.a},"93b6":function(t,e,i){"use strict";i.r(e);var n=i("cf53"),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=s.a},"9e07":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"baseView"},[i("view",{staticClass:"cellInfoView"},[i("uni-list-item",{attrs:{title:"发现人",subnote:t.fqr,"show-arrow":"false",mpcomid:"2898c793-0"}}),i("uni-list-item",{attrs:{title:"责任部门",subnote:t.zrbm,"show-arrow":"false",mpcomid:"2898c793-1"}}),i("uni-list",{attrs:{mpcomid:"2898c793-7"}},[i("uni-list-item",{attrs:{title:"隐患描述",subnote:t.bhgys,"show-arrow":"true",eventid:"2898c793-0",mpcomid:"2898c793-2"},on:{click:t.selectedbhgys}}),i("uni-list-item",{attrs:{title:"隐患级别",subnote:t.yhdj,"show-arrow":"true",eventid:"2898c793-1",mpcomid:"2898c793-3"},on:{click:t.selectedyhdj}}),i("uni-list-item",{attrs:{title:"隐患分类",subnote:t.yhhg,"show-arrow":"true",eventid:"2898c793-2",mpcomid:"2898c793-4"},on:{click:t.selectedyhhg}}),i("uni-list-item",{attrs:{title:"对应条款",subnote:t.wfflfgjtk,"show-arrow":"true",eventid:"2898c793-3",mpcomid:"2898c793-5"},on:{click:t.selectedwfflfgjtk}}),i("uni-list-item",{attrs:{title:"整改建议",subnote:t.gsyqjjy,"show-arrow":"true",eventid:"2898c793-4",mpcomid:"2898c793-6"},on:{click:function(e){t.jumpInput(t.gsyqjjy,"gsyqjjy","请输入整改要求及建议")}}})],1),i("view",{staticClass:"imageBaseView"},[i("view",{staticClass:"cellSubViewRow"},[i("text",{staticClass:"leftTextRow"},[t._v("隐患照片")]),i("text",{staticClass:"rightTextRow"},[t._v(t._s(t.imageList.length))])]),i("view",{staticClass:"imageView",attrs:{id:"imageView"}},[t._l(t.imageList,function(e,n){return i("block",{key:n},[i("view",{staticClass:"littleImageView",style:{width:t.littleImageWidth+"px",height:t.littleImageWidth+"px"}},[i("image",{staticClass:"littleImage",attrs:{id:n,src:e.src,mode:"aspectFit",eventid:"2898c793-5-"+n},on:{click:t.viewPhoto}}),i("image",{staticClass:"littleImageDelete",attrs:{src:"../../static/img/delete.png",id:n,mode:"aspectFit",eventid:"2898c793-6-"+n},on:{click:function(i){t.deleteImage(e,n)}}})])])}),i("view",{staticClass:"littleImageView",style:{width:t.littleImageWidth+"px",height:t.littleImageWidth+"px"},attrs:{eventid:"2898c793-7"},on:{click:t.addPhoto}},[i("image",{staticClass:"littleImage",attrs:{src:"../../static/img/addImage.png"}})])],2)])],1),i("view",{staticClass:"btnView"},[i("button",{staticClass:"saveBtn",attrs:{eventid:"2898c793-8"},on:{tap:t.saveClick}},[t._v("保存")])],1)])},s=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return s})},cf53:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=u(i("7cb5")),s=u(i("5718")),a=u(i("1578")),o=u(i("f5eb")),c=u(i("6c6c")),l=(u(i("89f5")),i("2f62"));function u(t){return t&&t.__esModule?t:{default:t}}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){f(t,e,i[e])})}return t}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var d={computed:(0,l.mapState)(["sublistItem","sublistIndex","userInfo","inputPageText","key"]),components:{uniList:n.default,uniListItem:a.default,uniIcon:s.default},data:function(){return{needGetInputOnShow:!1,item:"",itemIndex:0,imageViewHeight:100,imageList:[],littleImageWidth:0,id:"",yhdj:"",yhhg:"",bhgys:"",wfflfgjtk:"",gsyqjjy:"",zrbm:"",fqr:"",fj:"",yhdjData:["一般隐患","重大隐患"],yhhgData:["人员伤害","财产损失","其他"],bhgysData:["从隐患库选择/检索","自行输入问题","从常用隐患库选择"],wfflfgjtkData:["从隐患库选择/检索","自行输入问题","从法规库选择"],zrbmData:["从隐患库选择/检索","自行输入问题","从部门库选择"]}},onLoad:function(){var e=this;e.littleImageWidth=(t.getSystemInfoSync().windowWidth-50)/4,e.fqr=e.userInfo.fullname,c.default.requestLoadingNew(o.default.getUserDeptName,{userid:e.userInfo.userid},"正在加载",function(t){e.zrbm=t.dept},function(){},function(){})},onNavigationBarButtonTap:function(){},onShow:function(){1==this.needGetInputOnShow&&(this.$data[this.key]=this.inputPageText,this.needGetInputOnShow=!1,this.removeInputItem())},methods:r({},(0,l.mapMutations)(["removeInputItem","setSublistItem"]),{selectedyhdj:function(e){var i=this;t.showActionSheet({itemList:i.yhdjData,success:function(t){i.yhdj=i.yhdjData[t.tapIndex]},fail:function(t){console.log(t.errMsg)}})},selectedyhhg:function(e){var i=this;t.showActionSheet({itemList:i.yhhgData,success:function(t){i.yhhg=i.yhhgData[t.tapIndex]},fail:function(t){console.log(t.errMsg)}})},selectedbhgys:function(e){var i=this;t.showActionSheet({itemList:i.bhgysData,success:function(t){0==t.tapIndex||1==t.tapIndex&&(this.needGetInputOnShow=!0,i.jumpInput(i.bhgys,"bhgys","请输入隐患描述"))},fail:function(t){console.log(t.errMsg)}})},selectedwfflfgjtk:function(e){var i=this;t.showActionSheet({itemList:i.wfflfgjtkData,success:function(t){0==t.tapIndex||1==t.tapIndex&&(this.needGetInputOnShow=!0,i.jumpInput(i.wfflfgjtk,"wfflfgjtk","请输入对应条款"))},fail:function(t){console.log(t.errMsg)}})},checkDateChange:function(t){this.checkDate=t.target.value},deadLineChange:function(t){this.deadLine=t.target.value},saveItem:function(e){for(var i=this,n=o.default.uploadImage+"?from=flowyh&yyid="+i.id+"&fjlx=fj1&userid="+i.userInfo.userid,s=[],a=0;a<i.imageList.length;a++){var l=i.imageList[a];1!=l.type||l.src.startsWith("http:")||s.push(l.src)}if(0==s.length)return i.saveLocalItem(),void t.navigateBack({delta:1});t.showLoading({title:"正在上传图片"}),c.default.uploadImage(n,s,0,0,0,s.length,function(t){var e=JSON.parse(t.data),n=e.fj;i.fj=n},function(e){t.hideLoading(),"200"==e&&(i.saveLocalItem(),t.showToast({title:"上传成功",complete:setTimeout(function(){t.navigateBack({delta:1})},1500)}))})},saveLocalItem:function(){var t={item:this.item,index:this.itemIndex};this.setSublistItem(t)},saveClick:function(){var e=this,i={refid:e.id,yhdj:e.yhdj,yhhg:e.yhhg,bhgys:e.bhgys,wfflfgjtk:e.wfflfgjtk,gsyqjjy:e.gsyqjjy,zrbm:e.zrbm,fqr:e.fqr,userid:e.userInfo.userid};c.default.requestLoadingNew(o.default.addYhzgToFlow,i,"正在加载",function(i){t.showToast({icon:"none",title:"保存成功",duration:1e3}),console.log(""+JSON.stringify(i)),e.id=i.id,console.log(e.id),e.saveItem()},function(){t.showToast({icon:"none",title:"保存失败"})},function(){})},jumpInput:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"请输入描述";this.needGetInputOnShow=!0,t.navigateTo({url:"../common/inputPage?text="+e+"&key="+i+"&placeholder="+n})},addPhoto:function(){var e=this;t.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){console.log(JSON.stringify(t.tempFilePaths));for(var i=0;i<t.tempFilePaths.length;i++){var n={fileid:"",src:t.tempFilePaths[i],type:1};e.imageList.push(n)}}})},deleteImage:function(e,i){var n=this;if(e.src.startsWith("http:")){var s={item:n.item,index:n.itemIndex};n.setSublistItem(s);var a={from:"jc",yyid:n.item.id,fileid:e.fileid,userid:n.userInfo.userid};c.default.requestLoading(o.default.deleteImage,a,"正在删除图片",function(t){console.log("删除成功："+JSON.stringify(t)),n.item.fj=t.fj,n.imageList.splice(i,1)},function(){t.showToast({icon:"none",title:"删除失败"})},function(){})}else n.imageList.splice(i,1)},viewPhoto:function(){for(var e=this,i=[],n=0;n<e.imageList.length;n++){var s=e.imageList[n];i.push(s.src)}t.previewImage({urls:i})}})};e.default=d}).call(this,i("649d")["default"])},dc0c:function(t,e,i){},ff19:function(t,e,i){"use strict";i("835e");var n=a(i("b0ce")),s=a(i("3eb0"));function a(t){return t&&t.__esModule?t:{default:t}}Page((0,n.default)(s.default))}},[["ff19","common/runtime","common/vendor"]]]);