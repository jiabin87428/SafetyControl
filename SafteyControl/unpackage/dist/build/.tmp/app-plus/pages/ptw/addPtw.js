(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ptw/addPtw"],{"020f":function(t,e,i){"use strict";i.r(e);var s=i("eefe"),a=i("5ffa");for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);i("8a5f");var o=i("2877"),d=Object(o["a"])(a["default"],s["a"],s["b"],!1,null,null,null);e["default"]=d.exports},"5ffa":function(t,e,i){"use strict";i.r(e);var s=i("daba"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,function(){return s[t]})}(n);e["default"]=a.a},"8a5f":function(t,e,i){"use strict";var s=i("c584"),a=i.n(s);a.a},"958b":function(t,e,i){"use strict";i("de83");var s=n(i("b0ce")),a=n(i("020f"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,s.default)(a.default))},c584:function(t,e,i){},daba:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=c(i("7c03")),a=c(i("ba08")),n=c(i("4b9c")),o=c(i("17f7")),d=c(i("3731")),l=(c(i("59a9")),i("2f62"));function c(t){return t&&t.__esModule?t:{default:t}}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},s=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),s.forEach(function(e){u(t,e,i[e])})}return t}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var h={computed:(0,l.mapState)(["sublistItem","sublistIndex","userInfo","inputPageText","key"]),components:{uniList:s.default,uniListItem:n.default,uniIcon:a.default},data:function(){return{needGetInputOnShow:!1,imageViewHeight:100,imageList:[],littleImageWidth:0,item:"",itemIndex:0,id:"",dhzlx:"",zydw:"",dhfzr:"",dhfs:"",dhdd:"",sgxm:"",dhnr:"",zzjhr:"",zzjhrgw:"",ddjhr:"",ddjhrgw:"",whbs:"",dhqx:"",dhqx2:"",sfjxfxfx:"",sfyss:"",fj:"",aqcs:"",ssqk:"",sfData:["是","否"],dhzlxData:["特殊危险动火","一级动火","二级动火"]}},onLoad:function(){this.littleImageWidth=(t.getSystemInfoSync().windowWidth-50)/4},onNavigationBarButtonTap:function(){},onShow:function(){1==this.needGetInputOnShow&&(this.$data[this.key]=this.inputPageText,this.needGetInputOnShow=!1,this.removeInputItem())},methods:r({},(0,l.mapMutations)(["removeInputItem","setSublistItem"]),{selecteddhzlx:function(e){var i=this;t.showActionSheet({itemList:i.dhzlxData,success:function(t){i.dhzlx=i.dhzlxData[t.tapIndex]},fail:function(t){console.log(t.errMsg)}})},selectedsfjxfxfx:function(e){var i=this;t.showActionSheet({itemList:i.sfData,success:function(t){i.sfjxfxfx=i.sfData[t.tapIndex]},fail:function(t){console.log(t.errMsg)}})},selectedsfyss:function(e){var i=this;t.showActionSheet({itemList:i.sfData,success:function(t){i.sfyss=i.sfData[t.tapIndex]},fail:function(t){console.log(t.errMsg)}})},bindDateDhqx:function(t){this.dhqx=t.target.value},bindDateDhqx2:function(t){this.dhqx2=t.target.value},saveItem:function(e){for(var i=this,s=o.default.uploadImage+"?from=ptw&yyid="+i.id+"&userid="+i.userInfo.userid,a=[],n=0;n<i.imageList.length;n++){var l=i.imageList[n];1!=l.type||l.src.startsWith("http:")||a.push(l.src)}0!=a.length?(t.showLoading({title:"正在上传图片"}),d.default.uploadImage(s,a,0,0,0,a.length,function(t){var e=JSON.parse(t.data),s=e.fj;i.fj=s},function(e){t.hideLoading()})):i.saveLocalItem()},saveLocalItem:function(){var t={item:this.item,index:this.itemIndex};this.setSublistItem(t)},choiceICON:function(){var e=this,i=e.id;i?t.navigateTo({url:"rapSelected?recordid="+i}):t.showToast({icon:"none",title:"请先保存作业"})},savePTW:function(){this.saveClick(o.default.savePTW)},savePTWFlow:function(){this.saveClick(o.default.savePTWFlow)},saveAndClose:function(){var e=this;e.saveClick(o.default.savePTW),e.saveLocalItem(),t.showToast({title:"保存成功，即将关闭",complete:setTimeout(function(){t.navigateBack({delta:1})},1500)})},closeBtn:function(){var e=this;e.saveLocalItem(),t.showToast({title:"即将关闭",complete:setTimeout(function(){t.navigateBack({delta:1})},1500)})},saveClick:function(e){var i=this,s={userid:i.userInfo.userid,dhzlx:i.dhzlx,zydw:i.zydw,dhfzr:i.dhfzr,dhfs:i.dhfs,dhdd:i.dhdd,sgxm:i.sgxm,dhnr:i.dhnr,zzjhr:i.zzjhr,zzjhrgw:i.zzjhrgw,ddjhr:i.ddjhr,ddjhrgw:i.ddjhrgw,whbs:i.whbs,dhqx:i.dhqx,dhqx2:i.dhqx2,sfjxfxfx:i.sfjxfxfx,sfyss:i.sfyss,aqcs:i.aqcs,ssqk:i.ssqk},a=[{val:i.zydw,msg:"作业单位"},{val:i.dhfzr,msg:"动火负责人"},{val:i.dhfs,msg:"动火方式"},{val:i.dhdd,msg:"动火地点"},{val:i.sgxm,msg:"施工项目"},{val:i.dhnr,msg:"动火内容"},{val:i.zzjhr,msg:"组织监火人"},{val:i.zzjhrgw,msg:"组织监火人岗位"},{val:i.ddjhr,msg:"地点监火人"},{val:i.ddjhrgw,msg:"地点监火人岗位"},{val:i.whbs,msg:"危害辨识"},{val:i.aqcs,msg:"安全措施"},{val:i.ssqk,msg:"实施情况"}];i.checkVal(a)&&d.default.requestLoadingNew(e,s,"正在加载",function(e){t.showToast({icon:"none",title:"保存成功",duration:1e3}),console.log(""+JSON.stringify(e)),i.id=e.id,console.log(i.id),i.saveItem()},function(){t.showToast({icon:"none",title:"保存失败"})},function(){})},jumpInput:function(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"请输入描述";this.needGetInputOnShow=!0,t.navigateTo({url:"../common/inputPage?text="+e+"&key="+i+"&placeholder="+s})},addPhoto:function(){var e=this;t.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){console.log(JSON.stringify(t.tempFilePaths));for(var i=e.imageList,s=0;s<t.tempFilePaths.length;s++){var a={fileid:"",src:t.tempFilePaths[s],type:1};i.push(a)}}})},checkVal:function(e){for(var i in e)if(!e[i].val)return t.showToast({icon:"none",title:e[i].msg+"不能为空！"}),!1;return!0},deleteImage:function(e,i){var s=this;if(e.src.startsWith("http:")){var a={item:s.item,index:s.itemIndex};s.setSublistItem(a);var n={from:"jc",yyid:s.item.id,fileid:e.fileid,userid:s.userInfo.userid};d.default.requestLoading(o.default.deleteImage,n,"正在删除图片",function(t){console.log("删除成功："+JSON.stringify(t));var e=s.imageList;s.item.fj=t.fj,e.splice(i,1)},function(){t.showToast({icon:"none",title:"删除失败"})},function(){})}else imageList.splice(i,1)},viewPhoto:function(){for(var e=this,i=[],s=e.imageList,a=0;a<s.length;a++){var n=s[a];i.push(n.src)}t.previewImage({urls:i})}})};e.default=h}).call(this,i("649d")["default"])},eefe:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"baseView"},[t._m(0),i("view",{staticClass:"cellInfoView"},[i("uni-list-item",{attrs:{title:"动火证类型",subnote:t.dhzlx,"show-arrow":"true",eventid:"15ee3d3a-0",mpcomid:"15ee3d3a-0"},on:{click:t.selecteddhzlx}}),i("uni-list-item",{attrs:{title:"作业单位",subnote:t.zydw,"show-arrow":"true",eventid:"15ee3d3a-1",mpcomid:"15ee3d3a-1"},on:{click:function(e){t.jumpInput(t.zydw,"zydw","请输入作业单位")}}}),i("uni-list-item",{attrs:{title:"动火负责人",subnote:t.dhfzr,"show-arrow":"true",eventid:"15ee3d3a-2",mpcomid:"15ee3d3a-2"},on:{click:function(e){t.jumpInput(t.dhfzr,"dhfzr","请输入动火负责人")}}}),i("uni-list-item",{attrs:{title:"动火方式",subnote:t.dhfs,"show-arrow":"true",eventid:"15ee3d3a-3",mpcomid:"15ee3d3a-3"},on:{click:function(e){t.jumpInput(t.dhfs,"dhfs","请输入动火方式")}}}),i("uni-list-item",{attrs:{title:"动火地点",subnote:t.dhdd,"show-arrow":"true",eventid:"15ee3d3a-4",mpcomid:"15ee3d3a-4"},on:{click:function(e){t.jumpInput(t.dhdd,"dhdd","请输入动火地点")}}}),i("uni-list-item",{attrs:{title:"施工项目",subnote:t.sgxm,"show-arrow":"true",eventid:"15ee3d3a-5",mpcomid:"15ee3d3a-5"},on:{click:function(e){t.jumpInput(t.sgxm,"sgxm","请输入施工项目")}}}),i("uni-list-item",{attrs:{title:"动火内容",subnote:t.dhnr,"show-arrow":"true",eventid:"15ee3d3a-6",mpcomid:"15ee3d3a-6"},on:{click:function(e){t.jumpInput(t.dhnr,"dhnr","请输入动火内容")}}}),i("uni-list-item",{attrs:{title:"组织监火人",subnote:t.zzjhr,"show-arrow":"true",eventid:"15ee3d3a-7",mpcomid:"15ee3d3a-7"},on:{click:function(e){t.jumpInput(t.zzjhr,"zzjhr","请输入组织监火人")}}}),i("uni-list-item",{attrs:{title:"组织监火人岗位",subnote:t.zzjhrgw,"show-arrow":"true",eventid:"15ee3d3a-8",mpcomid:"15ee3d3a-8"},on:{click:function(e){t.jumpInput(t.zzjhrgw,"zzjhrgw","请输入组织监火人岗位")}}}),i("uni-list-item",{attrs:{title:"地点监火人",subnote:t.ddjhr,"show-arrow":"true",eventid:"15ee3d3a-9",mpcomid:"15ee3d3a-9"},on:{click:function(e){t.jumpInput(t.ddjhr,"ddjhr","请输入地点监火人")}}}),i("uni-list-item",{attrs:{title:"地点监火人岗位",subnote:t.ddjhrgw,"show-arrow":"true",eventid:"15ee3d3a-10",mpcomid:"15ee3d3a-10"},on:{click:function(e){t.jumpInput(t.ddjhrgw,"ddjhrgw","请输入地点监火人岗位")}}}),i("uni-list-item",{attrs:{title:"危害辨识",subnote:t.whbs,"show-arrow":"true",eventid:"15ee3d3a-11",mpcomid:"15ee3d3a-11"},on:{click:function(e){t.jumpInput(t.whbs,"whbs","请输入危害辨识")}}}),i("uni-list-item",{attrs:{title:"安全措施",subnote:t.aqcs,"show-arrow":"true",eventid:"15ee3d3a-12",mpcomid:"15ee3d3a-12"},on:{click:function(e){t.jumpInput(t.aqcs,"aqcs","请输入安全措施")}}}),i("uni-list-item",{attrs:{title:"实施情况",subnote:t.ssqk,"show-arrow":"true",eventid:"15ee3d3a-13",mpcomid:"15ee3d3a-13"},on:{click:function(e){t.jumpInput(t.ssqk,"ssqk","请输入实施情况")}}}),i("uni-list-item",{attrs:{title:"是否进行风险分析",subnote:t.sfjxfxfx,"show-arrow":"true",eventid:"15ee3d3a-14",mpcomid:"15ee3d3a-14"},on:{click:t.selectedsfjxfxfx}}),i("uni-list-item",{attrs:{title:"是否已实施",subnote:t.sfyss,"show-arrow":"true",eventid:"15ee3d3a-15",mpcomid:"15ee3d3a-15"},on:{click:t.selectedsfyss}}),i("view",{staticClass:"imageBaseView"},[i("view",{staticClass:"cellSubViewRow"},[i("text",{staticClass:"leftTextRow"},[t._v("附件")]),i("text",{staticClass:"rightTextRow"},[t._v(t._s(t.imageList.length))])]),i("view",{staticClass:"imageView",attrs:{id:"imageView"}},[t._l(t.imageList,function(e,s){return i("block",{key:s},[i("view",{staticClass:"littleImageView",style:{width:t.littleImageWidth+"px",height:t.littleImageWidth+"px"}},[i("image",{staticClass:"littleImage",attrs:{id:s,src:e.src,mode:"aspectFit",eventid:"15ee3d3a-16-"+s},on:{click:t.viewPhoto}}),i("image",{staticClass:"littleImageDelete",attrs:{src:"../../static/img/delete.png",id:s,mode:"aspectFit",eventid:"15ee3d3a-17-"+s},on:{click:function(i){t.deleteImage(e,s)}}})])])}),i("view",{staticClass:"littleImageView",style:{width:t.littleImageWidth+"px",height:t.littleImageWidth+"px"},attrs:{eventid:"15ee3d3a-18"},on:{click:t.addPhoto}},[i("image",{staticClass:"littleImage",attrs:{src:"../../static/img/addImage.png"}})])],2)])],1),t._m(1),i("view",{staticClass:"cellInfoView"},[i("picker",{attrs:{mode:"date",value:t.dhqx,eventid:"15ee3d3a-19"},on:{change:t.bindDateDhqx}},[i("uni-list-item",{attrs:{title:"动火期限起",subnote:t.dhqx,"show-arrow":"true",mpcomid:"15ee3d3a-16"}})],1),i("picker",{attrs:{mode:"date",value:t.dhqx2,eventid:"15ee3d3a-20"},on:{change:t.bindDateDhqx2}},[i("uni-list-item",{attrs:{title:"动火期限起",subnote:t.dhqx2,"show-arrow":"true",mpcomid:"15ee3d3a-17"}})],1)],1),t._m(2),i("view",{staticClass:"cellInfoView"},[i("uni-list-item",{attrs:{title:"安全措施选择器","show-arrow":"false",eventid:"15ee3d3a-21",mpcomid:"15ee3d3a-18"},on:{click:t.choiceICON}})],1),i("view",{staticClass:"btnView"},[i("button",{staticClass:"saveBtn",attrs:{eventid:"15ee3d3a-22"},on:{tap:t.savePTW}},[t._v("保存")]),i("button",{staticClass:"saveBtn",attrs:{eventid:"15ee3d3a-23"},on:{tap:t.savePTWFlow}},[t._v("发送工作流")]),i("button",{staticClass:"saveBtn",attrs:{eventid:"15ee3d3a-24"},on:{tap:t.saveAndClose}},[t._v("保存并关闭")]),i("button",{staticClass:"saveBtn",attrs:{eventid:"15ee3d3a-25"},on:{tap:t.closeBtn}},[t._v("关闭")])],1)])},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"cellTitleView"},[i("text",{staticClass:"cellTitle"},[t._v("基础信息")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"cellTitleView"},[i("text",{staticClass:"cellTitle"},[t._v("动火期限")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"cellTitleView"},[i("text",{staticClass:"cellTitle"},[t._v("安全措施选择器")])])}];i.d(e,"a",function(){return s}),i.d(e,"b",function(){return a})}},[["958b","common/runtime","common/vendor"]]]);