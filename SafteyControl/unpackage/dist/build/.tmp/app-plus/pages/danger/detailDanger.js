(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/danger/detailDanger"],{1490:function(e,t,a){"use strict";a.r(t);var n=a("5206"),i=a.n(n);for(var s in n)"default"!==s&&function(e){a.d(t,e,function(){return n[e]})}(s);t["default"]=i.a},1965:function(e,t,a){"use strict";(function(e){a("de83"),a("921b");n(a("66fd"));var t=n(a("d4a9"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},2533:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},i=[];a.d(t,"a",function(){return n}),a.d(t,"b",function(){return i})},"34ce":function(e,t,a){},5206:function(e,t,a){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(a("17f7")),s=r(a("3731")),o=(r(a("59a9")),a("2f62"));function r(e){return e&&e.__esModule?e:{default:e}}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(t){u(e,t,a[t])})}return e}function u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var d=function(){return a.e("components/list/uni-list/uni-list").then(a.bind(null,"7c03"))},f=function(){return a.e("components/list/uni-icon/uni-icon").then(a.bind(null,"ba08"))},g=function(){return a.e("components/list/uni-list-item/uni-list-item").then(a.bind(null,"4b9c"))},c={computed:(0,o.mapState)(["sublistItem","sublistIndex","userInfo","inputPageText","key"]),components:{uniList:d,uniListItem:g,uniIcon:f},data:function(){return{needGetInputOnShow:!1,imageViewHeight:100,imageList:[],imageList2:[],imageList3:[],littleImageWidth:0,fjflag:"",id:"",yhdj:"",yhhg:"",bhgys:"",wfflfgjtk:"",gsyqjjy:"",zrbm:"",fqr:"",zgwcrq:"",zlzj:"",zgr:"",tbrq:"",zgqk:"",tbr:"",zgyj:"",zgqx:"",txrq:"",yyfx:"",yzqk:"",yzr:"",tbrq2:"",taskDefKey:"",instId:"",nodeName:"",actDefId:"",obj:null,taskId:"",zgFlag:!1,spFlag:!1,yzFlag:!1,zgReadFlag:!0,spReadFlag:!0,yzReadFlag:!0,commonFlow:!0,owner:"",showFlow:"",destNodeData:[],destNodeParam:[],nodeParam:"",destNode:"",zgqkData:["点击输入整改情况"],zlzjData:["点击输入治理资金"],yzqkData:["点击输入验证情况"],yyfxData:["人","物","环","管"],zgyjData:["点击输入整改意见"],nodeFlag:!0}},onLoad:function(t){console.log(e("加载页面..."," at pages/danger/detailDanger.vue:214"));var a=this,o=JSON.parse(t.params);a.taskDefKey=o.taskDefKey,a.instId=o.instId,a.nodeName=o.name,a.actDefId=o.actDefId,a.taskId=o.taskId,a.owner=o.owner,a.showFlow=o.showFlow,a.commonFlow=o.commonFlow,s.default.requestLoadingNew(i.default.getYhzgDetail,o,"正在加载详情",function(t){var n=t.data;a.nodeFlag=!t.lx;var s,o,r=t.destNodeUserList,l=[],u=[];for(var d in r)s=r[d],o=s.taskNodeUser,u.push(o.userIds+":"+o.userFullnames+"@"+s.nodeId+":"+s.nodeText),l.push(s.nodeText+(o.userFullnames?"【"+o.userFullnames+"】":""));a.destNodeParam=u,a.destNodeData=l;var f=a.taskDefKey;if(a.id=n.id,a.yhdj=n.yhdj,a.yhhg=n.yhhg,a.bhgys=n.bhgys,a.wfflfgjtk=n.wfflfgjtk,a.gsyqjjy=n.gsyqjjy,a.zrbm=n.zrbm,a.fqr=n.fqr,n.fj){var g=JSON.parse(n.fj);for(d=0;d<g.length;d++){var c=g[d],h=i.default.host+i.default.loadImage+c.fileId+"&userid="+a.userInfo.userid,m={fileid:c.fileId,src:h,type:2};a.imageList.push(m)}}if("sid-A0CE4647-CCC3-4A9A-81BF-09FCAB7CDCA4"===f);else if("sid-3785D27C-9B73-4C6D-9C1C-6A4ECA6B8FFE"===f){if(a.zgReadFlag=!1,a.spReadFlag=!1,a.yzReadFlag=!1,a.zgqx=n.zgqx,a.tbr=n.tbr,a.txrq=n.txrq,a.zgyj=n.zgyj,a.zgwcrq=n.zgwcrq,a.zlzj=n.zlzj,a.zgr=n.zgr,a.tbrq=n.tbrq,a.zgqk=n.zgqk,n.fj2){console.log(e("FJ2:"+n.fj2," at pages/danger/detailDanger.vue:292"));var p=JSON.parse(n.fj2);for(d=0;d<p.length;d++){var y=p[d],z=i.default.host+i.default.loadImage+y.fileId+"&userid="+a.userInfo.userid,v={fileid:y.fileId,src:z,type:2};a.imageList2.push(v)}}if(a.yyfx=n.yyfx,a.yzqk=n.yzqk,a.yzr=n.yzr,a.tbrq2=n.tbrq2,n.fj3){console.log(e("FJ3:"+n.fj3," at pages/danger/detailDanger.vue:311"));var I=JSON.parse(n.fj3);for(d=0;d<I.length;d++){var j=I[d],q=i.default.host+i.default.loadImage+j.fileId+"&userid="+a.userInfo.userid,D={fileid:j.fileId,src:q,type:2};a.imageList3.push(D)}}}else if("sid-41BC6E14-5C85-42A1-8E1B-3246FDEA682C"===f)a.zgr=a.userInfo.fullname,a.zgFlag=!0,a.zgReadFlag=!1,a.spReadFlag=!1,a.zgqx=n.zgqx,a.tbr=n.tbr,a.txrq=n.txrq,a.zgyj=n.zgyj,a.fjflag="fj2";else if("sid-F7A5E243-31D1-42DE-9D74-0C7323EFFAF8"===f){if(a.yzr=a.userInfo.fullname,a.yzFlag=!0,a.zgReadFlag=!1,a.spReadFlag=!1,a.yzReadFlag=!1,a.fjflag="fj3",a.zgqx=n.zgqx,a.tbr=n.tbr,a.txrq=n.txrq,a.zgyj=n.zgyj,a.zgwcrq=n.zgwcrq,a.zlzj=n.zlzj,a.zgr=n.zgr,a.tbrq=n.tbrq,a.zgqk=n.zgqk,n.fj2){console.log(e("FJ2:"+n.fj2," at pages/danger/detailDanger.vue:358"));var b=JSON.parse(n.fj2);for(d=0;d<b.length;d++){var w=b[d],F=i.default.host+i.default.loadImage+w.fileId+"&userid="+a.userInfo.userid,k={fileid:w.fileId,src:F,type:2};a.imageList2.push(k)}}}else"sid-987522D1-34D6-45A4-8D16-CE1F2ACA0205"!==f&&"sid-29BBC59F-F04B-47BF-9DE1-7C3299318DB8"!==f||(a.tbr=a.userInfo.fullname,a.spFlag=!0,a.zgReadFlag=!1,a.spReadFlag=!1)},function(){n.showToast({icon:"none",title:"请求失败"})},function(){}),this.littleImageWidth=(n.getSystemInfoSync().windowWidth-50)/4,this.checkPeople=this.userInfo.fullname},onNavigationBarButtonTap:function(){},onShow:function(){1==this.needGetInputOnShow&&(this.$data[this.key]=this.inputPageText,this.needGetInputOnShow=!1,this.removeInputItem())},methods:l({},(0,o.mapMutations)(["removeInputItem","setSublistItem"]),{deadLineChange:function(e){this.deadLine=e.target.value},bindDateZgwcrq:function(e){this.zgwcrq=e.target.value},bindDateTbrq:function(e){this.tbrq=e.target.value},bindDateZgqx:function(e){this.zgqx=e.target.value},bindDateTxrq:function(e){this.txrq=e.target.value},bindDateTbrq2:function(e){this.tbrq2=e.target.value},selecteddestNode:function(t){var a=this;n.showActionSheet({itemList:a.destNodeData,success:function(e){a.nodeParam=a.destNodeParam[e.tapIndex],a.destNode=a.destNodeData[e.tapIndex]},fail:function(t){console.log(e(t.errMsg," at pages/danger/detailDanger.vue:430"))}})},selectedzlzj:function(t){var a=this;n.showActionSheet({itemList:a.zlzjData,success:function(e){0==e.tapIndex&&(this.needGetInputOnShow=!0,a.jumpInput(a.zlzj,"zlzj","请输入治理资金"))},fail:function(t){console.log(e(t.errMsg," at pages/danger/detailDanger.vue:446"))}})},selectedzgyj:function(t){var a=this;n.showActionSheet({itemList:a.zgyjData,success:function(e){0==e.tapIndex&&(this.needGetInputOnShow=!0,a.jumpInput(a.zgyj,"zgyj","请输入整改意见"))},fail:function(t){console.log(e(t.errMsg," at pages/danger/detailDanger.vue:462"))}})},selectedzgqk:function(t){var a=this;n.showActionSheet({itemList:a.zgqkData,success:function(e){0==e.tapIndex&&(this.needGetInputOnShow=!0,a.jumpInput(a.zgqk,"zgqk","请输入整改情况"))},fail:function(t){console.log(e(t.errMsg," at pages/danger/detailDanger.vue:478"))}})},selectedyyfx:function(t){var a=this;n.showActionSheet({itemList:a.yyfxData,success:function(e){a.yyfx=a.yyfxData[e.tapIndex]},fail:function(t){console.log(e(t.errMsg," at pages/danger/detailDanger.vue:491"))}})},selectedyzqk:function(t){var a=this;n.showActionSheet({itemList:a.yzqkData,success:function(e){0==e.tapIndex&&(this.needGetInputOnShow=!0,a.jumpInput(a.yzqk,"yzqk","请输入验证情况"))},fail:function(t){console.log(e(t.errMsg," at pages/danger/detailDanger.vue:507"))}})},historyClick:function(){var e=this,t={instId:e.instId,actDefId:e.actDefId};n.setStorageSync("params",JSON.stringify(t)),n.navigateTo({url:"../danger/readHistory"})},flowPicClick:function(){var e=this;plus.runtime.openWeb(i.default.host+i.default.showFlowPic+"?actInstId="+e.instId+"&host="+i.default.host)},backFlowClick:function(){this.jumpType="BACK",this.saveClick()},agreeFlowClick:function(){this.jumpType="AGREE",this.nodeParam?this.saveClick():n.showToast({icon:"none",title:"请选择操作节点"})},saveItem:function(t){var a=this,o=a.fjflag;if(console.log(e("flag:::"+o," at pages/danger/detailDanger.vue:568")),o){for(var r=i.default.uploadImage+"?from=flowyh&yyid="+a.id+"&fjlx="+o+"&userid="+a.userInfo.userid,l="fj2"===o?a.imageList2:"fj3"===o?a.imageList3:[],u=[],d=0;d<l.length;d++){var f=l[d];1!=f.type||f.src.startsWith("http:")||u.push(f.src)}if(0==u.length)return a.saveLocalItem(),void n.navigateBack({delta:1});n.showLoading({title:"正在上传图片"}),s.default.uploadImage(r,u,0,0,0,u.length,function(e){var t=JSON.parse(e.data),n=t.fj;a.fj=n},function(e){n.hideLoading(),"200"==e&&(a.saveLocalItem(),n.showToast({title:"上传成功",complete:setTimeout(function(){n.navigateBack({delta:1})},1500)}))})}else a.saveLocalItem()},saveLocalItem:function(){var e={item:0,index:0};this.setSublistItem(e)},saveClick:function(){var t=this,a={refid:t.id,id:t.id,userid:t.userInfo.userid,owner:t.owner,destNode:t.nodeParam,taskDefKey:t.taskDefKey,jumpType:t.jumpType,actDefId:t.actDefId,taskId:t.taskId};console.log(e(JSON.stringify(a)," at pages/danger/detailDanger.vue:640"));var o=t.taskDefKey;"sid-A0CE4647-CCC3-4A9A-81BF-09FCAB7CDCA4"===o||"sid-3785D27C-9B73-4C6D-9C1C-6A4ECA6B8FFE"===o||("sid-41BC6E14-5C85-42A1-8E1B-3246FDEA682C"===o?(a.zgwcrq=t.zgwcrq,a.zlzj=t.zlzj,a.zgr=t.zgr,a.tbrq=t.tbrq,a.zgqk=t.zgqk):"sid-F7A5E243-31D1-42DE-9D74-0C7323EFFAF8"===o?(a.yyfx=t.yyfx,a.yzqk=t.yzqk,a.yzr=t.yzr,a.tbrq2=t.tbrq2):"sid-987522D1-34D6-45A4-8D16-CE1F2ACA0205"!==o&&"sid-29BBC59F-F04B-47BF-9DE1-7C3299318DB8"!==o||(a.zgqx=t.zgqx,a.tbr=t.tbr,a.txrq=t.txrq,a.zgyj=t.zgyj)),s.default.requestLoadingNew(i.default.updateAndSendFlowForMobile,a,"正在加载",function(e){n.showToast({icon:"none",title:"操作成功！",duration:1e3}),t.saveItem()},function(){n.showToast({icon:"none",title:"保存失败"})},function(){setTimeout(function(){n.navigateBack({delta:1})},1500)})},jumpInput:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"请输入描述";this.needGetInputOnShow=!0,n.navigateTo({url:"../common/inputPage?text="+e+"&key="+t+"&placeholder="+a})},addPhoto:function(){var t=this;n.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(a){console.log(e(JSON.stringify(a.tempFilePaths)," at pages/danger/detailDanger.vue:697"));var n=t.fjflag;if(n)for(var i="fj2"===n?t.imageList2:"fj3"===n?t.imageList3:[],s=0;s<a.tempFilePaths.length;s++){var o={fileid:"",src:a.tempFilePaths[s],type:1};i.push(o)}}})},deleteImage:function(t,a){var o=this;if(t.src.startsWith("http:")){var r={item:o.item,index:o.itemIndex};o.setSublistItem(r);var l={from:"jc",yyid:o.item.id,fileid:t.fileid,userid:o.userInfo.userid};s.default.requestLoading(i.default.deleteImage,l,"正在删除图片",function(t){var n=o.fjflag;if(n){var i="fj2"===n?o.imageList2:"fj3"===n?o.imageList3:[];console.log(e("删除成功："+JSON.stringify(t)," at pages/danger/detailDanger.vue:734")),o.item.fj=t.fj,i.splice(a,1)}},function(){n.showToast({icon:"none",title:"删除失败"})},function(){})}else{var u=o.fjflag;if(u){var d="fj2"===u?o.imageList2:"fj3"===u?o.imageList3:[];d.splice(a,1)}}},viewPhoto:function(){var t=this,a=[],i=t.imageList.length>0?t.imageList:t.imageList2.length>0?t.imageList2:t.imageList3;console.log(e(JSON.stringify(i)," at pages/danger/detailDanger.vue:760"));for(var s=0;s<i.length;s++){var o=i[s];a.push(o.src)}n.previewImage({urls:a})}})};t.default=c}).call(this,a("0de9")["default"],a("6e42")["default"])},"520a":function(e,t,a){"use strict";var n=a("34ce"),i=a.n(n);i.a},d4a9:function(e,t,a){"use strict";a.r(t);var n=a("2533"),i=a("1490");for(var s in i)"default"!==s&&function(e){a.d(t,e,function(){return i[e]})}(s);a("520a");var o=a("2877"),r=Object(o["a"])(i["default"],n["a"],n["b"],!1,null,null,null);t["default"]=r.exports}},[["1965","common/runtime","common/vendor"]]]);